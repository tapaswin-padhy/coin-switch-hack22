import React, { useState, useEffect } from 'react'
import MultiSelect from 'react-multi-select-component'
import axios from 'axios'
import CanvasJSReact from '../assets/canvasjs.react'
var CanvasJS = CanvasJSReact.CanvasJS;
var CanvasJSChart = CanvasJSReact.CanvasJSChart;

const FishVulnerability = () => {

    const [ options, setOptions ] = useState(null)

    const [ stocks, setStocks ] = useState({data:[],label:[]})

    const [ selected, setSelected ] = useState([])

    useEffect(()=>{
        axios.get('http://localhost:8000/kobe-chart')
        .then(res => {
            var labels = []
            for(var i=0;i<res.data.length;i++){
                var v = {label:res.data[i].name,value:res.data[i].name}
                labels.push(v)
            }
            setStocks({data:res.data,label:labels})
        })
        .catch(err => console.log(err))
    },[])

    const plot = () => {
        var dPoints = []
        for(var i=0;i<stocks.data.length;i++){
            for(var j=0;j<selected.length;j++){
                if(selected[j].label===stocks.data[i].name){
                    var v = {x:stocks.data[i]["B/Bmsy"],y:stocks.data[i]["F/Fmsy"],name:stocks.data[i].name}
                    dPoints.push(v)
                }
            }
        }
        const op = {
			theme: "dark2",
			animationEnabled: true,
			zoomEnabled: true,
			title:{
				text: "Plot Stock Condition"
			},
			axisX: {
				title:"B/Bmsy",
				crosshair: {
					enabled: true,
					snapToDataPoint: true
				}
			},
			axisY:{
				title: "F/Fmsy",
				crosshair: {
					enabled: true,
					snapToDataPoint: true
				}
			},
			data: [{
				type: "scatter",
				markerSize: 15,
				toolTipContent: "B/Bmsy: {x} F/Fmsy: {y} label: {name}",
				dataPoints: dPoints
			}]
		}
        setOptions(op)
    }

    return (
        <div className='fish-vul'>
            <div className='fish-vul-options'>
                <div className='stock-title'>
                    Stocks : 
                </div>
                <MultiSelect
                options={stocks.label}
                value={selected}
                onChange={setSelected}
                labelledBy={"Select"}
                />
            </div>
            <div className='plot-btn btn btn-dark' onClick={plot}>Plot</div>
            <div className='plot'>
                {options!==null ? <CanvasJSChart options = {options}/> : null}
            </div>
        </div>
    )
}

export default FishVulnerability

